import{ba as g,k as w,G as L}from"./three.module-Cdr6prlM.js";import{L as P,r as d}from"./readMagicBytes-B3HEinov.js";import{B as T}from"./B3DMLoader-BP7KbjDP.js";import{P as b}from"./PNTSLoader-C1N3YT1_.js";import{W as y,I as M}from"./I3DMLoader-CCE0l15Y.js";class k extends P{parse(s){const n=new DataView(s),h=d(n);console.assert(h==="cmpt",'CMPTLoader: The magic bytes equal "cmpt".');const p=n.getUint32(4,!0);console.assert(p===1,'CMPTLoader: The version listed in the header is "1".');const l=n.getUint32(8,!0);console.assert(l===s.byteLength,"CMPTLoader: The contents buffer length listed in the header matches the file.");const c=n.getUint32(12,!0),a=[];let o=16;for(let r=0;r<c;r++){const t=new DataView(s,o,12),e=d(t),i=t.getUint32(4,!0),f=t.getUint32(8,!0),u=new Uint8Array(s,o,f);a.push({type:e,buffer:u,version:i}),o+=f}return{version:p,tiles:a}}}class V extends k{constructor(s=g){super(),this.manager=s,this.adjustmentTransform=new w,this.ellipsoid=y.clone()}parse(s){const n=super.parse(s),{manager:h,ellipsoid:p,adjustmentTransform:l}=this,c=[];for(const a in n.tiles){const{type:o,buffer:r}=n.tiles[a];switch(o){case"b3dm":{const t=r.slice(),e=new T(h);e.workingPath=this.workingPath,e.fetchOptions=this.fetchOptions,e.adjustmentTransform.copy(l);const i=e.parse(t.buffer);c.push(i);break}case"pnts":{const t=r.slice(),e=new b(h);e.workingPath=this.workingPath,e.fetchOptions=this.fetchOptions;const i=e.parse(t.buffer);c.push(i);break}case"i3dm":{const t=r.slice(),e=new M(h);e.workingPath=this.workingPath,e.fetchOptions=this.fetchOptions,e.ellipsoid.copy(p),e.adjustmentTransform.copy(l);const i=e.parse(t.buffer);c.push(i);break}}}return Promise.all(c).then(a=>{const o=new L;return a.forEach(r=>{o.add(r.scene)}),{tiles:a,scene:o}})}}export{V as C};
